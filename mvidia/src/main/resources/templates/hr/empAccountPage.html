<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/layout}"
      layout:fragment="content">
<head>
    <meta charset="UTF-8">
    <title>ğŸ‘¤ ì‚¬ì› ê³„ì • Â· ì‘ì—… ì„ íƒ</title>
    <style>
        .hrEmpAccount{grid-column:2;grid-row:2; background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);}
        .hrEmpAccount>.widget{background:#fff;border-radius:10px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
        .page-title{font-size:20px;margin:0 0 12px 0}
        .stack{display:flex;gap:10px;flex-wrap:wrap}
        .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;background-color:#0c197f ;color:#fff}
        .hrEmpAccount .btn:hover{color:#00BDA7;}
        .btn.alt{background:#0f7a90}
        .btn.warn{background:var(--warn)}
        .btn.danger{background:var(--danger)}
        .btn.ghost{background:transparent;color:#002B39;border:1px solid #002B39}
        .modal-body .input-group {display: flex; gap: 10px; align-items: center;}
        .modal-body .btn:hover{background:#0050be; color:#fff;}
        .emp-info { display: none; margin-top: 15px; padding: 15px; border-radius: 8px; background-color: #f0f4f7;}
        .emp-info .name, .emp-info .dept { font-weight: bold;}
        .error-message { display: none; color: var(--danger); margin-top: 10px;}
    </style>
</head>
<body>
    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="hrEmpAccount">
        <h2 class="page-title">ğŸ‘¤ ì‚¬ì› ê³„ì • Â· ì‘ì—… ì„ íƒ</h2>
        <div class="widget" id="home">
            <div class="stack">
                <a class="btn" th:href="@{/hr/accountCreate.hr}">ìƒì„±</a>
                <a class="btn alt"  data-toggle="modal" data-target="#updateModal">ìˆ˜ì •</a>
                <a class="btn danger" data-toggle="modal" data-target="#deleteModal">ì‚­ì œ</a>
                <a class="btn ghost" th:href="@{/hr/hrMainPage}">
                    <i class="bi bi-arrow-return-left"></i>
                    ë©”ì¸ìœ¼ë¡œ
                </a>
            </div>
        </div>
    </div>

    <!-- ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="updateModalLabel">ì‚¬ì› ê³„ì • ìˆ˜ì •</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <input id="updateEmpNo" class="form-control" type="text" placeholder="ì‚¬ë²ˆ ì…ë ¥" maxlength="8" />
                    </div>
                    <div class="emp-info" id="updateEmpInfo">
                        <p><strong>ì´ë¦„:</strong> <span id="updateEmpName"></span></p>
                        <p><strong>ì§ê¸‰:</strong> <span id="updateEmpRank"></span></p>
                        <p><strong>ë¶€ì„œ:</strong> <span id="updateEmpDept"></span></p>
                        <button class="btn" id="btnConfirmUpdate">ìˆ˜ì • ì§„í–‰</button>
                    </div>
                    <p class="error-message" id="updateErrorMsg"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‚­ì œ ëª¨ë‹¬ -->
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">ì‚¬ì› ê³„ì • ì‚­ì œ</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <input id="deleteEmpNo" class="form-control" type="text" placeholder="ì‚¬ë²ˆ ì…ë ¥" maxlength="8" />
                    </div>
                    <div class="emp-info" id="deleteEmpInfo">
                        <p><strong>ì´ë¦„:</strong> <span id="deleteEmpName"></span></p>
                        <p><strong>ì§ê¸‰:</strong> <span id="deleteEmpRank"></span></p>
                        <p><strong>ë¶€ì„œ:</strong> <span id="deleteEmpDept"></span></p>
                        <button class="btn danger" id="btnConfirmDelete">ì‚­ì œ ì§„í–‰</button>
                    </div>
                    <p class="error-message" id="deleteErrorMsg"></p>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            // ëª¨ë‹¬ì´ ë‹«í ë•Œ ë‚´ìš© ì´ˆê¸°í™”
            $('#updateModal, #deleteModal').on('hidden.bs.modal', function() {
                $(this).find('input').val('');
                $(this).find('.emp-info').hide();
                $(this).find('.error-message').hide();
            });

            // ì‚¬ë²ˆ ì…ë ¥ ì‹œ ë™ì  ì¡°íšŒ (ìˆ˜ì • ëª¨ë‹¬)
            $('#updateEmpNo').on('input', function() {
                searchEmployee($(this).val(), 'update');
            });

            // ì‚¬ë²ˆ ì…ë ¥ ì‹œ ë™ì  ì¡°íšŒ (ì‚­ì œ ëª¨ë‹¬)
            $('#deleteEmpNo').on('input', function() {
                searchEmployee($(this).val(), 'delete');
            });

            // ì‹¤ì œ ì„œë²„ì™€ í†µì‹ í•˜ëŠ” í•¨ìˆ˜ (AJAX)
            function searchEmployee(empNo, type) {
                const infoSelector = `#${type}EmpInfo`;
                const errorSelector = `#${type}ErrorMsg`;

                $(infoSelector).hide();
                $(errorSelector).hide();

                if (empNo.length === 8) {
                    // AJAX ìš”ì²­ ì‹œì‘
                    $.ajax({
                        url: '/hr/checkEmpNo.hr',
                        type: 'GET',
                        data: { empNo: empNo },
                        success: function(response) {

                            if (response) {
                                $(infoSelector).show();
                                $(`#${type}EmpName`).text(response.empName);
                                $(`#${type}EmpRank`).text(response.jobName);
                                $(`#${type}EmpDept`).text(response.deptName);
                            } else {
                                $(errorSelector).text('ì‚¬ë²ˆì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.').show();
                            }
                        },
                        error: function() {
                            $(errorSelector).text('ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.').show();
                        }
                    });
                } else if (empNo.length > 8) {
                    $(errorSelector).text('ì‚¬ë²ˆì´ 8ìë¦¬ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.').show();
                }
            }

            // ìˆ˜ì • í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ
            $('#btnConfirmUpdate').on('click', function() {
                const empNo = $('#updateEmpNo').val();
                location.href = `/hr/accountModifyDetail.hr?empNo=${empNo}`;
            });

            // ì‚­ì œ í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ
            $('#btnConfirmDelete').on('click', function() {
                const empNo = $('#deleteEmpNo').val();
                const empName = $('#deleteEmpName').text();
                const empRank = $('#deleteEmpRank').text();

                alertify.confirm(`${empName} ${empRank}ì˜ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,
                    function(e) {
                        if (e) {
                            // í™•ì¸(OK)ì„ ëˆ„ë¥´ë©´ ì‚­ì œ ë¡œì§ ì‹¤í–‰
                            $.ajax({
                                url: '/hr/accountDelete.hr',
                                type: 'POST',
                                data: { empNo: empNo },
                                success: function(response) {
                                    if (response.success) {
                                        alertify.success('ê³„ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                                        $('#deleteModal').modal('hide');
                                    } else {
                                        alertify.error('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + response.message);
                                    }
                                },
                                error: function() {
                                    alertify.error('ì„œë²„ í†µì‹  ì˜¤ë¥˜ë¡œ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                                }
                            });
                        }
                    },
                    function() {
                        alertify.error('ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }
                );
            });
        });
    </script>
</body>
</html>