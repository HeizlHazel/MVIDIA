<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:fragment="menubar">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .sb{width:250px;min-height:100vh;background:linear-gradient(to bottom,#002B39,#003661,#186AEA);padding-top:60px;position:fixed;left:0;top:0;z-index:999}
        .menu{list-style:none;margin:0;padding:0}
        .menu>li{position:relative}
        .menu .link{text-decoration:none}
        .link{display:flex;align-items:center;gap:10px;padding:12px;border-radius:12px;color:#e7f2f7;cursor:pointer}
        .link:hover{background:#013547; color: #e7f2f7;}
        .submenu{display:none;margin:6px 0 10px 8px;border-left:2px solid rgba(255,255,255,.1);padding-left:8px}
        .submenu a{display:block;padding:8px 10px;border-radius:10px;color:#e7f2f7;text-decoration:none}
        .submenu a:hover{background:rgba(255,255,255,.08)}
        .menu>li.open>.submenu{display:block}
        .submenu.open {display: block !important;}
        .submenu a.active {background:rgba(255,255,255,.08)}
        .menu .link.active{background:rgba(255,255,255,.08); color: #e7f2f7;}
    </style>
</head>
<body>
    <div th:fragment="menubar" class="sb">
        <ul class="menu" id="sideMenu">
            <li>
                <a class="link" th:href="@{/mainPage}">ğŸ  HOME</a>
            </li>

            <li>
                <div class="link" data-toggle>ğŸ‘¤ ë§ˆì´í˜ì´ì§€</div>
                <div class="submenu">
                    <a th:href="@{/mypage/profile}">ê°œì¸ì •ë³´ ì¡°íšŒ</a>
                    <a th:href="@{/mypage/update}">ê°œì¸ì •ë³´ ìˆ˜ì • ìš”ì²­</a>
                </div>
            </li>

            <li>
                <div class="link" data-toggle>ğŸ•’ ê·¼íƒœê´€ë¦¬</div>
                <div class="submenu">
                    <a th:href="@{/attend/main}">ê·¼íƒœ ë©”ì¸</a>
                    <a th:href="@{/attend/vacation}">íœ´ê°€ ì‹ ì²­</a>
                </div>
            </li>

            <li>
                <div class="link" data-toggle>ğŸ“ ì „ìê²°ì¬</div>
                <div class="submenu">
                    <a th:href="@{/approval/main}">ê²°ì¬ ë©”ì¸</a>
                    <a th:href="@{/approval/apply}">ì‹ ì²­</a>
                </div>
            </li>

            <li>
                <div class="link" data-toggle>âœ‰ï¸ ìª½ì§€</div>
                <div class="submenu">
                    <a th:href="@{/message/inbox}">ìˆ˜ì‹ í•¨</a>
                    <a th:href="@{/message/outbox}">ë°œì‹ í•¨</a>
                    <a th:href="@{/message/compose}">ìª½ì§€ ë³´ë‚´ê¸°</a>
                </div>
            </li>

            <li>
                <div class="link" data-toggle>ğŸ§­ ì¸ì‚¬ê´€ë¦¬</div>
                <div class="submenu">
                    <a th:href="@{/hr/hrMainPage}">ì¸ì‚¬ê´€ë¦¬ ë©”ì¸</a>
                    <a th:href="@{/hr/empAccount.hr}">ì‚¬ì› ê³„ì • ìƒì„±/ìˆ˜ì •/ì‚­ì œ</a>
                    <a th:href="@{/hr/integrated}">ì¸ì‚¬ í†µí•© ê´€ë¦¬</a>
                    <a th:href="@{/hr/attendance}">ê·¼íƒœ/íœ´ê°€ í†µí•©</a>
                    <a th:href="@{/hr/cert}">ì¦ëª…ì„œ ì¡°íšŒ/ë°œê¸‰</a>
                </div>
            </li>

            <!-- ì§ì±…ë³„ ë…¸ì¶œ ì˜ˆì‹œ: ë¶€ì¥ ì´ìƒì¼ ë•Œë§Œ ì¡°ì§ë„ -->
            <li sec:authorize="hasAnyRole('MANAGER','ADMIN')">
                <a class="link" th:href="@{/org}">ğŸ§© ì¡°ì§ë„</a>
            </li>
        </ul>
    </div>

    <script>
        (function () {
            const menu = document.getElementById('sideMenu');
            if (!menu) return;

            // **1. í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ë©”ë‰´ í™œì„±í™”**
            document.addEventListener('DOMContentLoaded', function() {
                const currentPath = window.location.pathname;

                // ëª¨ë“  ì†Œë©”ë‰´ ë§í¬ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
                const submenuLinks = document.querySelectorAll('.submenu a');

                submenuLinks.forEach(link => {
                    // ë§í¬ì˜ href ì†ì„±ì´ í˜„ì¬ URL ê²½ë¡œë¥¼ í¬í•¨í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
                    if (currentPath.includes(link.getAttribute('href'))) {
                        // í•´ë‹¹ ë§í¬ì— 'active' í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ ê°•ì¡°í•©ë‹ˆë‹¤.
                        link.classList.add('active');

                        // ë¶€ëª¨ ëŒ€ë©”ë‰´ë¥¼ ì°¾ì•„ 'open' ìƒíƒœë¡œ ë§Œë“­ë‹ˆë‹¤.
                        const li = link.closest('li');
                        if (li) {
                            li.classList.add('open');
                            const btn = li.querySelector('.link[data-toggle]');
                            if (btn) {
                                btn.setAttribute('aria-expanded', 'true');
                            }
                        }
                    }
                });

                // HOME ë§í¬ (ë‹¨ë… ë§í¬) ì²˜ë¦¬
                const homeLink = document.querySelector('.link[href="/mainPage"]');
                if (homeLink && currentPath.includes(homeLink.getAttribute('href'))) {
                    homeLink.classList.add('active');
                }
            });

            // **2. ì•„ì½”ë””ì–¸ ë©”ë‰´ ë™ì‘ (í´ë¦­ ì‹œ)**
            menu.addEventListener('click', (e) => {
                const btn = e.target.closest('.link[data-toggle]');
                if (!btn || !menu.contains(btn)) return;

                const li = btn.closest('li');
                const isOpen = li.classList.contains('open');

                // ë‹¤ë¥¸ ëª¨ë“  ëŒ€ë©”ë‰´ ë‹«ê¸°
                menu.querySelectorAll(':scope > li.open').forEach((other) => {
                    if (other !== li) {
                        other.classList.remove('open');
                        const hdr = other.querySelector(':scope > .link[data-toggle]');
                        if (hdr) hdr.setAttribute('aria-expanded', 'false');
                    }
                });

                // í´ë¦­ëœ ë©”ë‰´ í† ê¸€
                li.classList.toggle('open', !isOpen);
                btn.setAttribute('aria-expanded', String(!isOpen));
            });

            // **3. ì ‘ê·¼ì„± ë° í‚¤ë³´ë“œ ë™ì‘**
            menu.querySelectorAll('.link[data-toggle]').forEach((hdr) => {
                hdr.setAttribute('aria-expanded', 'false');
                hdr.setAttribute('role', 'button');
                hdr.setAttribute('tabindex', '0');
            });

            menu.addEventListener('keydown', (e) => {
                const isActivator = e.target.matches('.link[data-toggle]');
                if (!isActivator) return;
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    e.target.click();
                }
            });
        })();
    </script>
</body>
</html>