<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}"
      layout:fragment="content">
<head>
    <meta charset="UTF-8">
    <title>ê²½ì˜ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ì¹´ë“œ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .dashboard-card {
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 25px;
            background-color: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            height: 100%;
        }
        .dashboard-card h2 {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dashboard-card p b {
            font-size: 20px;
            color: #212121;
        }
        .shortcut-btn {
            font-size: 15px;
            padding: 6px 14px;
        }
        .dashboard-icon {
            font-size: 32px;
            vertical-align: middle;
            margin-right: 6px;
            color: #0050be;
        }

        /* row ê°„ê²© */
        .row {
            margin-bottom: 20px;
        }

        /* ì°¨íŠ¸ ìº”ë²„ìŠ¤ ê³ ì • ë†’ì´ */
        #yearlyChart {
            height: 300px !important;
            max-height: 300px;
        }
    </style>
</head>
<body>
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>ê²½ì˜ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h2>
</div>

<div class="container-fluid mt-3">
    <div class="row">
        <!-- ê¸‰ì—¬ê´€ë¦¬ ìš”ì•½ -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <h2>
                    <span class="material-symbols-outlined dashboard-icon">paid</span>
                    ê¸‰ì—¬ê´€ë¦¬ ìš”ì•½
                    <a href="/finance/payroll" class="btn btn-secondary btn-sm shortcut-btn"> ê¸‰ì—¬ í˜„í™© ë°”ë¡œê°€ê¸°</a>
                </h2>
                <p>
                    <b th:text="'â‚©' + ${#numbers.formatInteger(avgNetPay, 3, 'COMMA')}">â‚©0</b>
                    ì´ë²ˆë‹¬ í‰ê·  ì‹¤ì§€ê¸‰ì•¡
                </p>
                <p>
                    <b th:text="'â‚©' + ${#numbers.formatInteger(totalNetPay, 3, 'COMMA')}">â‚©0</b>
                    ì´ë²ˆë‹¬ ì´ ì‹¤ì§€ê¸‰ì•¡
                </p>
                <p><b th:text="|${empCount}ëª…|">0ëª…</b> ì§€ê¸‰ ëŒ€ìƒ ì¸ì›</p>
                <small class="text-muted">â€» ì´ë²ˆë‹¬: <span th:text="${thisMonth}"></span></small>
            </div>
        </div>

        <!-- ìˆ˜ìµ í˜„í™© -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <h2>
                    <span class="material-symbols-outlined dashboard-icon">add_chart</span>
                    <span th:text="|${quarter}ë¶„ê¸° ìˆ˜ìµ í˜„í™©|"></span>
                    <a href="/finance/revenue-report" class="btn btn-secondary btn-sm shortcut-btn"> ë¶„ê¸°ë³„ ìˆ˜ìµ ì¡°íšŒí•˜ê¸°</a>
                </h2>
                <p><b th:text="'â‚©'+${#numbers.formatInteger(revenueSummary['totalSales']/100000000,3,'COMMA')}+'ì–µ'">â‚©0</b> í˜„ì¬ ë¶„ê¸° ë§¤ì¶œ</p>
                <p>
                    <span th:text="'ì˜ì—…ì´ìµë¥ : ' + ${#numbers.formatDecimal(revenueSummary['profitRate'],1,1)} + '%'">0%</span>
                </p>
                <p><b th:text="'â‚©'+${#numbers.formatInteger(ytd,3,'COMMA')}+'ì–µ'">â‚©0</b> ì˜¬í•´ ì´ë§¤ì¶œ</p>
                <small class="text-muted">â€» ì„ íƒ ì—°ë„: <span th:text="${year}"></span></small>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- ì¬ê³  í˜„í™© -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <h2>
                    <span class="material-symbols-outlined dashboard-icon">inventory_2</span>
                    ë¶€í’ˆ ì¬ê³  í˜„í™©
                    <a href="/finance/inventory" class="btn btn-secondary btn-sm shortcut-btn"> ì œí’ˆ í˜„í™© ì¡°íšŒí•˜ê¸°</a>
                </h2>
                <p><b th:text="|${normalCnt}ê°œ|">0ê°œ</b> ì •ìƒ</p>
                <p><b th:text="|${lowCnt}ê°œ|">0ê°œ</b> ë¶€ì¡±</p>
                <small class="text-muted">â€» ì‹¤ì‹œê°„ ì¬ê³  ê¸°ì¤€</small>
                <div th:if="${lowList != null and !#lists.isEmpty(lowList)}">
                    <hr>
                    <p class="text-danger fw-bold">ë¶€ì¡± í’ˆëª©:</p>
                    <ul>
                        <li th:each="c : ${lowList}">
                            <span th:text="${c.cpName}"></span>
                            (<span th:text="${c.qty}"></span>ê°œ)
                        </li>
                    </ul>
                </div>

                <!-- ë¶€ì¡± í’ˆëª©ì´ ì—†ì„ ë•Œ -->
                <div th:if="${lowList == null or #lists.isEmpty(lowList)}">
                    <p class="text-success">í˜„ì¬ ë¶€ì¡± í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤ !!</p>
                </div>
            </div>
        </div>

        <!-- ì—°ê°„ ìˆ˜ìµ ê·¸ë˜í”„ -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <h2>ğŸ“Š 2025ë…„ ì—°ê°„ ìˆ˜ìµ (ë¶„ê¸°ë³„)</h2>
                <canvas id="yearlyChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const totalSales = /*[[${totalSales}]]*/ [];
    const totalProfits = /*[[${totalProfits}]]*/ [];

    new Chart(document.getElementById("yearlyChart"), {
        type: "bar",
        data: {
            labels: ["1ë¶„ê¸°", "2ë¶„ê¸°", "3ë¶„ê¸°", "4ë¶„ê¸°"],
            datasets: [
                {
                    label: "ì´ë§¤ì¶œ",
                    data: totalSales,
                    backgroundColor: "rgba(0, 80, 190, 0.7)",
                    yAxisID: "y",
                    barPercentage: 0.6,
                    categoryPercentage: 0.8
                },
                {
                    label: "ì˜ì—…ì´ìµ",
                    data: totalProfits,
                    type: "line",
                    borderColor: "orange",
                    borderWidth: 3,
                    pointRadius: 5,
                    pointBackgroundColor: "orange",
                    fill: false,
                    yAxisID: "y1"
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false, /* ê³ ì • ë†’ì´ ì¤€ ìƒíƒœì—ì„œ ë¹„ìœ¨ ìœ ì§€ X */
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ": " + context.raw.toFixed(1) + "ì–µ";
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 4000,   // â† ë§¤ì¶œ ì¶•ì„ 4000ì–µìœ¼ë¡œ ê³ ì •
                    title: {display: true, text: "ë§¤ì¶œ (ì–µì›)"},
                    ticks: {callback: val => val + "ì–µ"}
                },
                y1: {
                    beginAtZero: true,
                    max: 2000,   // â† ì˜ì—…ì´ìµ ì¶•ì„ 2000ì–µìœ¼ë¡œ ê³ ì •
                    position: "right",
                    title: {display: true, text: "ì˜ì—…ì´ìµ (ì–µì›)"},
                    ticks: {callback: val => val + "ì–µ"}
                }
            }
        }
    });
</script>

</body>
</html>
