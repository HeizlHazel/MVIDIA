<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:fragment="header">
<head>
    <meta charset="UTF-8">
    <title>MVIDIA ERP</title>
    <style>
        /* Í∏∞Ï°¥ CSSÎäî Ïú†ÏßÄ */
        .tb {
            height: 64px;
            background: #002B39;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .25);
        }

        .logo-img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            margin-right: 10px;
            display: block;
        }

        .tb .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            cursor: pointer;
        }

        .top-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .pill {
            background: rgba(255, 255, 255, .12);
            border: 1px solid rgba(255, 255, 255, .2);
            border-radius: 999px;
            padding: 6px 10px;
            font-variant-numeric: tabular-nums;
            font-weight: 700;
        }

        .session-box {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mini-btn {
            height: 30px;
            background: transparent;
            color: #fff;
            border: 1px solid #000000;
            padding: 6px 10px;
            border-radius: 999px;
            cursor: pointer;
            line-height: 50%;
        }

        .mini-btn:hover {
            background: rgba(255, 255, 255, .12);
        }

        .countdown {
            min-width: 78px;
            padding: 6px 10px;
            font-variant-numeric: tabular-nums;
            text-align: center;
            font-weight: 800;
            background-color: #1F4551;
            border-color: #1F4551;
            border-radius: 999px;
        }

        .logout {
            border-radius: 999px;
            background: #dc3545;
            border-color: #dc3545;
        }

        .extend {
            border-radius: 999px;
            background-color: #6C757D;
            border-color: #6C757D;
        }

        /* ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê† Î≤ÑÌäºÏùÑ ÏúÑÌïú Ïä§ÌÉÄÏùº */
        .checkin-btn {
            background-color: #28a745;
            border-color: #28a745;
        }
        .checkout-btn {
            background-color: #007bff;
            border-color: #007bff;
        }


        .icon {
            position: relative;
            font-size: 20px;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
        }

        .badge {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            background: #ff4444;
            display: grid;
            place-items: center;
            font-size: 10px;
        }

        .tb .profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e1e9ee;
        }

        .pf {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid #ddd;
        }

        .meta {
            display: flex;
            flex-direction: column;
            line-height: 1.5;
        }

        .meta .name {
            font-weight: 600;
            font-size: 15px;
            text-align: center;
        }

        .meta .dept {
            font-size: 11px;
            opacity: .9;
            text-align: center;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/alertify.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/css/alertify.min.css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/css/themes/default.min.css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/css/themes/semantic.min.css"/>
</head>
<body>
<script>
    alertify.defaults = {
        // dialogs defaults
        autoReset: true,
        basic: false,
        closable: true,
        closableByDimmer: true,
        invokeOnCloseOff: false,
        frameless: false,
        defaultFocusOff: false,
        maintainFocus: true, // <== global default not per instance, applies to all dialogs
        maximizable: true,
        modal: true,
        movable: true,
        moveBounded: false,
        overflow: true,
        padding: true,
        pinnable: true,
        pinned: true,
        preventBodyShift: false, // <== global default not per instance, applies to all dialogs
        resizable: true,
        startMaximized: false,
        transition: 'pulse',
        transitionOff: false,
        tabbable: 'button:not(:disabled):not(.ajs-reset),[href]:not(:disabled):not(.ajs-reset),input:not(:disabled):not(.ajs-reset),select:not(:disabled):not(.ajs-reset),textarea:not(:disabled):not(.ajs-reset),[tabindex]:not([tabindex^="-"]):not(:disabled):not(.ajs-reset)',  // <== global default not per instance, applies to all dialogs

        // notifier defaults
        notifier: {
            // auto-dismiss wait time (in seconds)
            delay: 5,
            // default position
            position: 'bottom-right',
            // adds a close button to notifier messages
            closeButton: false,
            // provides the ability to rename notifier classes
            classes: {
                base: 'alertify-notifier',
                prefix: 'ajs-',
                message: 'ajs-message',
                top: 'ajs-top',
                right: 'ajs-right',
                bottom: 'ajs-bottom',
                left: 'ajs-left',
                center: 'ajs-center',
                visible: 'ajs-visible',
                hidden: 'ajs-hidden',
                close: 'ajs-close'
            }
        },

        // language resources
        glossary: {
            // dialogs default title
            title: 'MVIDIA ALERT',
            // ok button text
            ok: 'ÌôïÏù∏',
            // cancel button text
            cancel: 'Ï∑®ÏÜå'
        },

        // theme settings
        theme: {
            // class name attached to prompt dialog input textbox.
            input: 'ajs-input',
            // class name attached to ok button
            ok: 'ajs-ok',
            // class name attached to cancel button
            cancel: 'ajs-cancel'
        },
        // global hooks
        hooks: {
            // invoked before initializing any dialog
            preinit: function (instance) {
            },
            // invoked after initializing any dialog
            postinit: function (instance) {
            },
        },
    };
</script>
<th:block th:if="${alertMsg != null}">
    <script th:inline="javascript">
        alertify.alert([[${alertMsg}]]);
    </script>
</th:block>

<div th:fragment="header (sessionSeconds=3600, logoPath=@{/images/mVIDIA_2-Photoroom.png})" class="tb">
    <div class="logo" onclick="clickLogo()">
        <img class="logo-img" th:src="@{/images/MVIDIA_Logo.png}" alt="MVIDIA Î°úÍ≥†">
        <div>MVIDIA ¬∑ ERP</div>
    </div>

    <div class="top-right">
        <div class="session-box" aria-label="ÏÑ∏ÏÖò Ï†úÏñ¥">
            <span id="sessionCountdown" class="countdown"
                  th:attr="data-seconds=${sessionSeconds?:0}"
                  th:text="${#numbers.formatInteger((sessionSeconds?:0)/60, 2)} + ':'
                  + ${#numbers.formatInteger((sessionSeconds?:0)%60, 2)}">
                60:00
            </span>

            <form id="extendForm" th:action="@{/session/extend}" method="post" class="extend">
                <input type="hidden" name="_csrf" th:value="${_csrf?.token}"/>
                <button class="mini-btn extend-btn" type="submit">Ïó∞Ïû•</button>
            </form>

            <form id="logoutForm" th:action="@{/logout.emp}" method="post" class="logout">
                <input type="hidden" name="_csrf" th:value="${_csrf?.token}"/>
                <button class="mini-btn" type="submit">Î°úÍ∑∏ÏïÑÏõÉ</button>
            </form>
        </div>

        <div class="icon" id="messageIcon" title="Ï™ΩÏßÄ">üìß<span class="badge" id="messageCount"
                                                             th:text="${messageCount?:0}">0</span></div>
        <div class="icon" id="notificationIcon" title="ÏïåÎ¶º">üîî<span class="badge" id="notificationCount"
                                                                  th:text="${notificationCount?:0}">0</span></div>

        <div class="profile" onclick="clickProf()">
            <div class="avatar">
                <th:block th:unless="${session.loginEmp.changeName != null}">
                    <img id="profile-preview" class="pf" th:src="@{/images/default_profile.png}" alt="Í∏∞Î≥∏ ÌîÑÎ°úÌïÑ">
                </th:block>
                <th:block th:if="${session.loginEmp.changeName != null}">
                    <img id="profile-preview" th:src="@{/uploadFiles/{fileName}(fileName=${atch.changeName})}"
                         alt="ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑ" class="pf">
                </th:block>
            </div>
            <div class="meta">
                <div class="name" id="userName" th:text="|${session.loginEmp.empLName}${session.loginEmp.empName}|"></div>
                <div class="dept" id="userDept" th:text="${session.loginEmp.deptName}"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function clickLogo() {
        location.href = "/mainPage";
    }

    function clickProf() {
        location.href = "/myPage/profile";
    }
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script th:src="@{/js/layout.js}"></script>
</body>
</html>