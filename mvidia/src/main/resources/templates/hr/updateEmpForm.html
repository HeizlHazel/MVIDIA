<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/layout}"
      layout:fragment="content">
<head>
    <meta charset="UTF-8">
    <title>ì‚¬ì› ì •ë³´ ë³€ê²½</title>
    <style>
        .accountCreate{grid-column:2; grid-row:2; background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);}
        .accountCreate>.widget{background:#fff;border-radius:10px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
        .form{display:grid;grid-template-columns:repeat(2,minmax(220px,1fr));gap:14px}
        .profile-section {display: flex; align-items: center; gap: 20px; margin-bottom: 15px;}
        .profile-pic {width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 1px solid #ddd;}
        .form .field{display:flex;flex-direction:column;gap:8px}
        .form label{font-size:12px;color:var(--muted)}
        .form input,.form select,.form textarea{padding:10px 12px;border-radius:12px;border:1px solid #dde6ec;background:#fff;outline:none}
        .form input[readonly]{background:#f1f5f8;color:#6f7c83}
        .form .full{grid-column:1/-1}
        .form .actions{grid-column:1/-1;display:flex;gap:8px;margin-top:6px}
        .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;background-color:#0c197f ;color:#fff}
        .btn.ghost{background:transparent;color:#002B39;border:1px solid #002B39}
    </style>
</head>
<body>

<!-- ë©”ì¸ ì»¨í…ì¸  -->
<div class="accountCreate">
    <h2 class="page-title">ğŸ– ì‚¬ì› ì •ë³´ ë³€ê²½</h2>
    <div class="widget" id="home">
        <form th:action="@{/updateEmp.hr}" class="form" method="post">
            <div class="profile-section">
                <div th:if="${atch == null}">
                    <img class="profile-pic" th:src="@{/images/default_profile.png}" alt="ê¸°ë³¸ í”„ë¡œí•„">
                </div>
                <div th:unless="${atch == null}">
                    <img th:src="@{/uploadFiles/{fileName}(fileName=${atch.changeName})}" alt="í”„ë¡œí•„ ì‚¬ì§„" class="profile-pic">
                </div>
            </div>
            <div class="field full"><label>ì‚¬ë²ˆ*</label><input name="empNo" th:value="${emp.empNo}" placeholder=" ìë™ ìƒì„±" readonly /></div>
            <div class="field full"><label>ì´ë©”ì¼*</label><input name="email" type="email" th:value="${emp.email}"  placeholder="ì‚¬ë²ˆ@gmail.com ìë™ ìƒì„±" readonly/></div>
                <div class="profile-section">
                    <th:block th:unless="${atch != null && atch.fileStatus == 'U'}">
                        <img id="profile-preview" class="profile-pic" th:src="@{/images/default_profile.png}" alt="ê¸°ë³¸ í”„ë¡œí•„">
                    </th:block>
                    <th:block th:if="${atch != null && atch.fileStatus == 'U'}">
                        <img id="profile-preview" th:src="@{/uploadFiles/{fileName}(fileName=${atch.changeName})}" alt="í”„ë¡œí•„ ì‚¬ì§„" class="profile-pic">
                    </th:block>
                    <div class="file-input-group">
                        <label style="margin-right:10px;" th:text="${atch != null ? atch.originName : 'í”„ë¡œí•„ ì‚¬ì§„ ë¯¸ ì²¨ë¶€'}"></label>
                        <br>
                        <span>ë³€ê²½í•  í”„ë¡œí•„ ì‚¬ì§„ : </span>
                        <input name="atchFile" type="file" accept="image/*" onchange="previewProfilePic(event)">

                    </div>
                </div>
            <div class="field"><label>ì„±*</label><input name="empLName" th:value="${emp.empLName}" required /></div>
            <div class="field"><label>ì´ë¦„*</label><input name="empName" th:value="${emp.empName}" required /></div>
            <div class="field"><label>ì˜ë¬¸ ì„±*</label><input name="empEngLName" th:value="${emp.empEngLName}" required /></div>
            <div class="field"><label>ì˜ë¬¸ ì´ë¦„*</label><input name="empEngName" th:value="${emp.empEngName}" required /></div>
            <div class="field"><label>ìƒë…„ì›”ì¼*</label><input name="birthday" type="date" th:value="${emp.birthday}" required  /></div>
            <div class="field"><label>ë¶€ì„œ*</label>
                <select name="deptCode" required>
                    <option value="">ì„ íƒ</option>
                    <option value="D1" th:selected="${emp.deptCode == 'D1'}">ì¸ì‚¬íŒ€</option>
                    <option value="D2" th:selected="${emp.deptCode == 'D2'}">ê²½ì˜ê´€ë¦¬íŒ€</option>
                    <option value="D3" th:selected="${emp.deptCode == 'D3'}">ìƒì‚°í’ˆì§ˆê´€ë¦¬íŒ€</option>
                    <option value="D4" th:selected="${emp.deptCode == 'D4'}">ê¸°ìˆ ì§€ì›íŒ€</option>
                </select>
            </div>
            <div class="field"><label>ì§ê¸‰*</label>
                <select name="jobNo" required>
                    <option value="">ì„ íƒ</option>
                    <option th:selected="${jobNo == '5'}" value="1">ì‚¬ì›</option>
                    <option th:selected="${jobNo == '4'}" value="2">ëŒ€ë¦¬</option>
                    <option th:selected="${jobNo == '3'}" value="3">ê³¼ì¥</option>
                    <option th:selected="${jobNo == '2'}" value="4">ì°¨ì¥</option>
                    <option th:selected="${jobNo == '1'}" value="5">ë¶€ì¥</option>
                </select>
            </div>
            <div class="field full"><label>ì£¼ì†Œ*</label><input name="address" th:value="${emp.address}" required /></div>
            <div class="field"><label>ì „í™”ë²ˆí˜¸*</label><input name="phone" placeholder="010-0000-0000" th:value="${emp.phone}" required/></div>
            <div class="field"><label>ë‚´ì„ ë²ˆí˜¸</label><input name="extNo" placeholder="1234" th:value="${emp.extNo}" /></div>
            <div class="field"><label>ì…ì‚¬ì¼*</label><input name="hireDate" type="date" th:value="${emp.hireDate}" required readonly /></div>
            <!-- ì²¨ë¶€ íŒŒì¼ ì •ë³´ë¥¼ ë‹¤ìŒ í˜ì´ì§€ë¡œ ë„˜ê¸°ê¸° ìœ„í•œ hidden í•„ë“œ ì¶”ê°€ -->
            <input type="hidden" name="originName" th:value="${atch.originName}" />
            <input type="hidden" name="changeName" th:value="${atch.changeName}" />
            <input type="hidden" name="refType" th:value="${atch.refType}" />
            <input type="hidden" id="jobCode" name="jobCode" th:value="${emp.jobCode}">
            <div class="actions">
                <button class="btn" type="submit">ê³„ì • ìƒì„±</button>
                <a class="btn ghost" th:href="@{/hr/empAccount.hr}">ì·¨ì†Œ</a>
            </div>
        </form>

        <script>
            $(document).ready(function() {
                // ë¶€ì„œ ë˜ëŠ” ì§ê¸‰ ì„ íƒì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ í•¨ìˆ˜ ì‹¤í–‰
                $('select[name="deptCode"], select[name="jobNo"]').on('change', function() {
                    updateJobCode();
                });

                // job_codeë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
                function updateJobCode() {
                    const deptCode = $('select[name="deptCode"]').val();
                    const jobNo = $('select[name="jobNo"]').val();

                    let deptInitial = "";

                    // ë¶€ì„œ ì½”ë“œ(D1, D2)ë¥¼ Jì½”ë“œë¡œ ë³€í™˜
                    switch(deptCode) {
                        case 'D1':
                            deptInitial = 'J1';
                            break;
                        case 'D2':
                            deptInitial = 'J2';
                            break;
                        case 'D3':
                            deptInitial = 'J3';
                            break;
                        case 'D4':
                            deptInitial = 'J4';
                            break;
                    }

                    // ë‘ ê°’ì´ ëª¨ë‘ ì„ íƒë˜ì—ˆì„ ë•Œë§Œ job_code ì¡°í•©
                    if (deptInitial && jobNo) {
                        const combinedCode = deptInitial + jobNo;
                        $("#jobCode").val(combinedCode);
                    } else {
                        // í•˜ë‚˜ë¼ë„ ì„ íƒë˜ì§€ ì•Šì•˜ë‹¤ë©´ ê°’ ì´ˆê¸°í™”
                        $("#jobCode").val("");
                    }
                }
            });
        </script>

    </div>
</div>

<script th:if="${alertMsg}">
    const alertMsg = '[[${alertMsg}]]';
    alertify.alert('ê³„ì • ìƒì„± ì™„ë£Œ', alertMsg);
</script>

</body>
</html>