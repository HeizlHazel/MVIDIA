<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}"
      layout:fragment="content">
<head>
    <meta charset="UTF-8">
    <title>ê²½ì˜ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ì¹´ë“œ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .dashboard-card {
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 25px;
            background-color: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            height: 100%;
        }
        .dashboard-card h2 {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dashboard-card p b {
            font-size: 20px;
            color: #212121;
        }
        .shortcut-btn {
            font-size: 15px;
            padding: 6px 14px;
        }
        .dashboard-icon {
            font-size: 32px;
            vertical-align: middle;
            margin-right: 6px;
            color: #0050be;
        }

        /* row ê°„ê²© */
        .row {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>ê²½ì˜ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h2>
</div>

<div class="container-fluid mt-3">
    <div class="row">
        <!-- ê¸‰ì—¬ê´€ë¦¬ ìš”ì•½ -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <h2>
                    <span class="material-symbols-outlined dashboard-icon">paid</span>
                    ê¸‰ì—¬ê´€ë¦¬ ìš”ì•½
                    <a href="/finance/payroll" class="btn btn-secondary btn-sm shortcut-btn"> ê¸‰ì—¬ í˜„í™© ë°”ë¡œê°€ê¸°</a>
                </h2>
                <p>
                    <b th:text="'â‚©' + ${#numbers.formatInteger(avgNetPay, 3, 'COMMA')}">â‚©0</b>
                    ì´ë²ˆë‹¬ í‰ê·  ì‹¤ì§€ê¸‰ì•¡
                </p>
                <p>
                    <b th:text="'â‚©' + ${#numbers.formatInteger(totalNetPay, 3, 'COMMA')}">â‚©0</b>
                    ì´ë²ˆë‹¬ ì´ ì‹¤ì§€ê¸‰ì•¡
                </p>
                <p><b th:text="|${empCount}ëª…|">0ëª…</b> ì§€ê¸‰ ëŒ€ìƒ ì¸ì›</p>
                <small class="text-muted">â€» ì´ë²ˆë‹¬: <span th:text="${thisMonth}"></span></small>
            </div>
        </div>

        <!-- ìˆ˜ìµ í˜„í™© -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <h2>
                    <span class="material-symbols-outlined dashboard-icon">add_chart</span>
                    <span th:text="|${quarter}ë¶„ê¸° ìˆ˜ìµ í˜„í™©|"></span>
                    <a href="/finance/revenue-report" class="btn btn-secondary btn-sm shortcut-btn"> ë¶„ê¸°ë³„ ìˆ˜ìµ ì¡°íšŒí•˜ê¸°</a>
                </h2>
                <p><b th:text="'â‚©'+${#numbers.formatInteger(revenueSummary['totalSales']/100000000,3,'COMMA')}+'ì–µ'">â‚©0</b> í˜„ì¬ ë¶„ê¸° ë§¤ì¶œ</p>
                <p>
                    <span th:text="'ì˜ì—…ì´ìµë¥ : ' + ${#numbers.formatDecimal(revenueSummary['profitRate'],1,1)} + '%'">0%</span>
                </p>
                <p><b th:text="'â‚©'+${#numbers.formatInteger(ytd,3,'COMMA')}+'ì–µ'">â‚©0</b> ì˜¬í•´ ì´ë§¤ì¶œ</p>
                <small class="text-muted">â€» ì„ íƒ ì—°ë„: <span th:text="${year}"></span></small>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- ì¬ê³  í˜„í™© -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <h2>
                    <span class="material-symbols-outlined dashboard-icon">inventory_2</span>
                    ë¶€í’ˆ ì¬ê³  í˜„í™©
                    <a href="/finance/inventory" class="btn btn-secondary btn-sm shortcut-btn"> ì œí’ˆ í˜„í™© ì¡°íšŒí•˜ê¸°</a>
                </h2>
                <p><b th:text="|${normalCnt}ê°œ|">0ê°œ</b> ì •ìƒ</p>
                <p><b th:text="|${lowCnt}ê°œ|">0ê°œ</b> ë¶€ì¡±</p>
                <small class="text-muted">â€» ì‹¤ì‹œê°„ ì¬ê³  ê¸°ì¤€</small>
                <div th:if="${#lists.isEmpty(lowList) == false}">
                    <hr>
                    <p class="text-danger fw-bold">ë¶€ì¡± í’ˆëª©:</p>
                    <ul>
                        <li th:each="c : ${lowList}" th:text="${c.cpName} + ' (' + c.qty + 'ê°œ)'"></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ì œí’ˆë³„ ë¶„ê¸° ìˆ˜ìµ ê·¸ë˜í”„ -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <h2>ğŸ“ˆ ì œí’ˆë³„ ë¶„ê¸° ìˆ˜ìµ (ë‹¨ìœ„: ì–µì›)</h2>
                <canvas id="productChart" style="height:300px"></canvas>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const productRevenueMap = /*[[${productRevenueMap}]]*/ {};
    const year = /*[[${year}]]*/ 2025;

    const labels = Object.keys(productRevenueMap);
    const values = Object.values(productRevenueMap).map(v => v / 100000000.0);

    new Chart(document.getElementById("productChart"), {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                label: "ë§¤ì¶œì•¡",
                data: values,
                backgroundColor: "rgba(0, 80, 190, 0.7)"
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: year + "ë…„ " + /*[[${quarter}]]*/ 1 + "ë¶„ê¸° ì œí’ˆë³„ ë§¤ì¶œ"
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.label + ": " + context.raw.toFixed(1) + "ì–µ";
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: "ë§¤ì¶œ (ì–µì›)" }
                }
            }
        }
    });
</script>
</body>
</html>
