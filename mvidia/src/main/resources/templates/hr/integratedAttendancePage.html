<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/layout}"
      layout:fragment="content">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MVIDIA · ERP - 인사관리 · 근태/휴가 관리</title>
    <style>
        .hr-integratedAtt { grid-column: 2; grid-row: 2; background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow);  width: 1200px; margin: 0 auto; }
        .hr-integratedAtt > .widget { background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0, 0, 0, .1); }
        .hr-integratedAtt .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
        .hr-integratedAtt .grid2{display:grid;grid-template-columns:repeat(2,minmax(260px,1fr));gap:16px}
        .hr-integratedAtt .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;background-color:#0c197f ;color:#fff}
        .hr-integratedAtt .btn.ghost{background:transparent;color:var(--brand);border:1px solid var(--brand)}
        .table{width:100%;border-collapse:separate;border-spacing:0 8px}
        .table th{font-size:12px;color:#698492;text-align:left;padding:0 10px}
        .table td{background:#fff;padding:12px;border-top:1px solid #e7eef3;border-bottom:1px solid #e7eef3}
        .hr-integratedAtt .chip{display:inline-block;padding:4px 8px;border-radius:999px;background:#e7f3f7;color:#07566a;font-size:11px}
        .card-header-action {display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;}
        .card-header-action h3 {margin: 0;}
        .card-header-action .btn {font-size: 12px; padding: 6px 10px; background-color: #0c197f;}
        .hr-integratedAtt .hidden{display:none !important;}
        .hr-integratedAtt #vacationPreview table, .hr-integratedAtt #attendPreview table {width: 100%; border-collapse: collapse;}
        .hr-integratedAtt #vacationPreview th, .hr-integratedAtt #attendPreview th {text-align: left; padding: 8px 0; font-size: 12px; color: var(--muted);}
        .hr-integratedAtt #vacationPreview td, .hr-integratedAtt #attendPreview td {padding: 8px 0;}
        .hr-integratedAtt #vacationPreview tbody tr, .hr-integratedAtt #attendPreview tbody tr {border-bottom: 1px solid #eee;}
        .hr-integratedAtt #vacationPreview tbody tr:last-child, .hr-integratedAtt #attendPreview tbody tr:last-child {border-bottom: none;}
    </style>
</head>
<body>
<div class="hr-integratedAtt">
    <div class="widget" id="home">
        <h3>⏰ 근태/휴가 통합 관리</h3>
        <br>
        <div class="grid2 mt8">
            <div class="card" style="position:relative">
                <div class="card-header-action">
                    <h4 style="margin:0 0 8px">휴가 신청 (최근 5건)</h4>
                    <a class="btn card-footer-action" href="/hr/vacationList.hr?cpage=1">정보 더보기</a>
                </div>
                <div id="vacationPreview">
                    <table class="preview-table">
                        <thead>
                        <tr>
                            <th>사번</th>
                            <th>이름</th>
                            <th>종류</th>
                            <th>기간</th>
                            <th>사유</th>
                            <th>상태</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card" style="position:relative">
                <div class="card-header-action">
                    <h4 style="margin:0 0 8px">근태 정보 (최근 5건)</h4>
                    <a class="btn card-footer-action" href="/hr/attendanceList.hr?cpage=1">정보 더보기</a>
                </div>
                <div id="attendPreview">
                    <table class="preview-table">
                        <thead>
                        <tr>
                            <th>사번</th>
                            <th>이름</th>
                            <th>일자</th>
                            <th>출근</th>
                            <th>퇴근</th>
                            <th>상태</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        fetchRecentVacations();
        fetchRecentAttendances();
    });

    // 최근 휴가 신청 5건을 AJAX로 가져와 테이블에 삽입하는 함수
    function fetchRecentVacations() {
        $.ajax({
            url: '/hr/vacations/recent5',
            type: 'GET',
            success: function(response) {
                const tbody = $('#vacationPreview tbody');
                tbody.empty();
                if (response.length > 0) {
                    response.forEach(va => {
                        const row = `
                            <tr>
                                <td>${va.empNo}</td>
                                <td>${va.empName}</td>
                                <td>${va.vaName}</td>
                                <td>${va.vaStart}~${va.vaEnd}</td>
                                <td style="width:150px">${va.vaReason}</td>>
                                <td><span class="chip">${va.vaStatusName}</span></td>
                            </tr>
                        `;
                        tbody.append(row);
                    });
                } else {
                    const emptyRow = `<tr><td colspan="4" class="muted" style="text-align: center;">신청 내역이 없어요.</td></tr>`;
                    tbody.append(emptyRow);
                }
            },
            error: function(xhr) {
                console.error("최근 휴가 신청 목록을 불러오는 데 실패했습니다: ", xhr.responseText);
                const tbody = $('#vacationPreview tbody');
                tbody.html(`<tr><td colspan="4" class="muted" style="text-align: center;">데이터 로드 실패</td></tr>`);
            }
        });
    }

    // 최근 근태 기록 5건을 AJAX로 가져와 테이블에 삽입하는 함수
    function fetchRecentAttendances() {
        $.ajax({
            url: '/hr/attendances/recent5',
            type: 'GET',
            success: function(response) {
                const tbody = $('#attendPreview tbody');
                tbody.empty();
                if (response.length > 0) {
                    response.forEach(attend => {
                        const row = `
                            <tr>
                                <td>${attend.empNo}</td>
                                <td>${attend.empName}</td>
                                <td>${attend.attDate}</td>
                                <td>${attend.arrivingTime || '-'}</td>
                                <td>${attend.leavingTime || '-'}</td>
                                <td><span class="chip">${attend.attStatusName}</span></td>
                            </tr>
                        `;
                        tbody.append(row);
                    });
                } else {
                    const emptyRow = `<tr><td colspan="5" class="muted" style="text-align: center;">근태 내역이 없어요.</td></tr>`;
                    tbody.append(emptyRow);
                }
            },
            error: function(xhr) {
                console.error("최근 근태 기록을 불러오는 데 실패했습니다: ", xhr.responseText);
                const tbody = $('#attendPreview tbody');
                tbody.html(`<tr><td colspan="5" class="muted" style="text-align: center;">데이터 로드 실패</td></tr>`);
            }
        });
    }

</script>
</body>
</html>